# 基于深度学习的隐形眼镜边缘缺陷检测

本仓库包含四川大学电气工程学院《数字图像处理》课程作业——“基于深度学习的隐形眼镜边缘缺陷检测”项目的代码与资源。

该项目提出了一种 CNN-MLP 网络结构，用于识别和分类图像中隐形眼镜边缘的缺陷。

**[English Version (英文版)](README.md)**

## 项目摘要

本项目提出了一种基于深度学习的隐形眼镜边缘缺陷检测方法。该方法利用卷积神经网络（CNN）提取图像块的局部特征，随后通过多层感知机（MLP）进行缺陷分类。为了提高模型的泛化性能，设计了一系列数据增强方案，包括旋转、添加高斯噪声和椒盐噪声。实验结果表明，该模型在多种数据条件下具有良好的稳定性和适应性：在标准图像和旋转图像上，准确率、精确率和召回率均达到100%；在高斯噪声条件下召回率为97%，在椒盐噪声条件下召回率略降至77%。这为工业产品缺陷的自动化检测提供了有效的解决方案。

## 主要特性

*   **CNN-MLP 架构:** 结合CNN进行特征提取和MLP进行分类。
*   **基于图像块的处理:** 将图像分割为25x25的图像块，进行局部缺陷分析。
*   **数据增强:** 包括旋转、高斯噪声、椒盐噪声，以提高模型的鲁棒性和泛化能力。
*   **自动化缺陷检测:** 旨在为人工检测提供一种高效的替代方案。

## 方法论

1.  **数据集准备:**
    *   原始隐形眼镜图像及其对应的缺陷掩模图像。
    *   图像通过以下方式进行增强：
        *   旋转 (90°, 180°, 270°)
        *   添加高斯噪声
        *   添加椒盐噪声
    *   包含一个自补充数据集 (`image_new.bmp`, `mask_new.bmp`)。
    *   图像被分割成25x25像素的图像块。每个图像块根据掩模被标记为缺陷或非缺陷。

2.  **模型结构 (CNN-MLP):**
    *   **CNN部分:**
        *   输入: 1通道 25x25 图像块。
        *   Conv1: 16个滤波器, 卷积核大小 3x3, padding 1, ReLU激活函数。
        *   MaxPool1: 池化核大小 2x2, 步长 2。
        *   Conv2: 32个滤波器, 卷积核大小 3x3, padding 1, ReLU激活函数。
        *   MaxPool2: 池化核大小 2x2, 步长 2。
        *   输出特征图被展平 (32 * 6 * 6)。
    *   **MLP部分:**
        *   FC1: 全连接层 (输入 32\*6\*6, 输出 128), ReLU激活函数。
        *   FC2: 全连接层 (输入 128, 输出 1), Sigmoid激活函数用于二分类。

3.  **训练:**
    *   优化器: Adam (学习率 1e-3)。
    *   损失函数: 二元交叉熵损失 (BCELoss)。
    *   训练轮次: 100。

## 结果总结

模型在不同图像条件下进行了测试（每种条件20轮）：

| 测试条件         | 准确率   | 精确率   | 召回率 | 误报率 (FPR) | 漏报率 (FNR) |
| :--------------- | :------- | :------- | :----- | :----------- | :----------- |
| 原始图像         | 100%     | 100%     | 100%   | 0%           | 0%           |
| 旋转图像 (90°)   | 100%     | 100%     | 100%   | 0%           | 0%           |
| 旋转图像 (180°)  | 100%     | 100%     | 100%   | 0%           | 0%           |
| 旋转图像 (270°)  | 100%     | 100%     | 100%   | 0%           | 0%           |
| 添加高斯噪声     | 99.98%   | 97.98%   | 97%    | 0.007%       | 3%           |
| 添加椒盐噪声     | 99.91%   | 98.72%   | 77%    | 0.004%       | 23%          |
| 自补充图像       | 100%     | 100%     | 100%   | 0%           | 0%           |

*注：误报率和漏报率根据论文中的数据推算。*

## 技术栈

*   Python 3.x
*   PyTorch
*   Torchvision
*   Pillow (PIL)
*   NumPy
*   Matplotlib

## 安装与配置

1.  **克隆仓库:**
    ```bash
    git clone https://github.com/your-username/your-repository-name.git
    cd your-repository-name
    ```

2.  **创建虚拟环境 (推荐):**
    ```bash
    python -m venv venv
    source venv/bin/activate  # Windows系统: venv\Scripts\activate
    ```

3.  **安装依赖:**
    ```bash
    pip install -r requirements.txt
    ```

4.  **数据集:**
    确保训练图像 (`image.bmp`, `mask0.bmp`, `image_new.bmp`, `mask_new.bmp`) 放置在项目目录下的 `train/` 子文件夹中。代码期望的目录结构如下：
    ```
    your-repository-name/
    ├── train/
    │   ├── image.bmp
    │   ├── mask0.bmp
    │   ├── image_new.bmp
    │   └── mask_new.bmp
    ├── dataset.py
    ├── main.py
    ├── Network.py
    ├── README_CN.md
    └── requirements.txt
    ```

## 使用方法

`main.py` 脚本用于模型的训练和测试。

1.  **训练模型:**
    *   在 `main.py` 中, 取消注释 `instance.Train()` 和 `instance.save_model()`这两行。
    *   注释掉 `instance.load_model()` 和 `instance.Test()`。
    *   运行脚本:
        ```bash
        python main.py
        ```
    *   这将训练模型100个周期，并将训练好的权重保存到 `model.pth`。

2.  **使用预训练模型进行测试:**
    *   确保 `model.pth` (您自己训练的或提供的) 位于项目根目录。
    *   在 `main.py` 中, 确保 `instance.load_model()` 和 `instance.Test()` 这两行被取消注释。
    *   注释掉 `instance.Train()` 和 `instance.save_model()`。
    *   默认情况下, `instance.Test()` 使用 `self.data.image_T_list[6]` (即 `image_new.bmp`)进行测试。您可以在 `Test()` 函数中更改索引或取消注释其他行以测试带噪声的图像。
    *   运行脚本:
        ```bash
        python main.py
        ```
    *   脚本将加载模型，在选定的测试图像上执行推理，并显示带有红色高亮缺陷区域的原始图像。

## 文件结构

*   `dataset.py`: 包含 `Data` 类，用于加载、增强和分块图像。
*   `Network.py`: 定义 CNN-MLP 神经网络结构。
*   `main.py`: 用于训练、测试、模型保存/加载和可视化的主脚本。
*   `result.txt`: 实验运行的真阳性、真阴性等原始摘要。
*   `model.pth`: (训练后生成) 保存的模型权重。
*   `train/`: 包含输入图像和掩模的文件夹。
*   `requirements.txt`: 列出Python包依赖项。

## 课程信息

*   **课程:** 数字图像处理
*   **单位:** 四川大学电气工程学院
